samples = ["PanelA_LAB1_LIB1", "PanelA_LAB1_LIB2", "PanelA_LAB1_LIB3", "PanelA_LAB1_LIB4",
           "PanelA_LAB2_LIB1", "PanelA_LAB2_LIB2", "PanelA_LAB2_LIB3", "PanelA_LAB2_LIB4",
           "PanelA_LAB3_LIB1", "PanelA_LAB3_LIB2", "PanelA_LAB3_LIB3", "PanelA_LAB3_LIB4",
           "PanelB_LAB1_LIB1", "PanelB_LAB1_LIB2", "PanelB_LAB1_LIB3", "PanelB_LAB1_LIB4",
           "PanelB_LAB2_LIB1", "PanelB_LAB2_LIB2", "PanelB_LAB2_LIB3", "PanelB_LAB2_LIB4",
           "PanelB_LAB3_LIB1", "PanelB_LAB3_LIB2", "PanelB_LAB3_LIB3", "PanelB_LAB3_LIB4"]

rule all:
    input:
      expand("{prefix}/041_{prefix}.vcf", prefix = samples),
      expand("{prefix}/Consensus.sSNV.vcf.gz.csi", prefix = samples),
      expand("{prefix}/Consensus.sINDEL.vcf.gz.csi", prefix = samples)

# step 1 bcftools view
rule bcftools_view_snv:
    input: 
      "{prefix}/Consensus.sSNV.vcf"
    output: 
      "{prefix}/Consensus.sSNV.vcf.gz"
    params:
      extra = "-Oz"
    wrapper:
      "v1.7.0/bio/bcftools/view"


rule bcftools_view_indel:
    input: 
      "{prefix}/Consensus.sINDEL.vcf"
    output:
      "{prefix}/Consensus.sINDEL.vcf.gz"
    params:
      extra = "-Oz"
    wrapper:
      "v1.7.0/bio/bcftools/view"

# step 2 bcftools index
rule bcftools_index_snv:
    input: 
      "{prefix}/Consensus.sSNV.vcf.gz"
    output: 
      "{prefix}/Consensus.sSNV.vcf.gz.csi"
    wrapper:
      "v1.7.0/bio/bcftools/index"

rule bcftools_index_indel:
    input: 
      "{prefix}/Consensus.sINDEL.vcf.gz"
    output: 
      "{prefix}/Consensus.sINDEL.vcf.gz.csi"
    wrapper:
      "v1.7.0/bio/bcftools/index"

# step 3 bcftools concat
rule bcftools_concat:
    input: 
      calls=["{prefix}/Consensus.sSNV.vcf.gz", "{prefix}/Consensus.sINDEL.vcf.gz"],

    output: 
      "{prefix}/041_{prefix}.vcf"
    params:
      extra="-a"
    wrapper:
      "v1.7.0/bio/bcftools/concat"
    
      
